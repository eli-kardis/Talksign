module.exports = {

"[project]/apps/app/.next-internal/server/app/api/customers/route/actions.js [app-rsc] (server actions loader, ecmascript)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
}}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/stream [external] (stream, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}}),
"[externals]/http [external] (http, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}}),
"[externals]/url [external] (url, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}}),
"[externals]/punycode [external] (punycode, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("punycode", () => require("punycode"));

module.exports = mod;
}}),
"[externals]/https [external] (https, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[project]/apps/app/src/lib/auth-utils.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s({
    "createAuthenticatedSupabaseClient": ()=>createAuthenticatedSupabaseClient,
    "createServerSupabaseClient": ()=>createServerSupabaseClient,
    "createUserSupabaseClient": ()=>createUserSupabaseClient,
    "getUserFromRequest": ()=>getUserFromRequest
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@supabase/supabase-js/dist/module/index.js [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwt$2f$verify$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/jose/dist/webapi/jwt/verify.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwks$2f$remote$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/jose/dist/webapi/jwks/remote.js [app-route] (ecmascript)");
;
;
function createAuthenticatedSupabaseClient(request) {
    const supabaseUrl = ("TURBOPACK compile-time value", "https://fwbkesioorqklhlcgmio.supabase.co");
    const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY || ("TURBOPACK compile-time value", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ3Ymtlc2lvb3Jxa2xobGNnbWlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyNDkxNzgsImV4cCI6MjA3MDgyNTE3OH0.YWsNJBHYzbm-y-zRNfxRu777qVU_8NYEWmLa62tf-3I");
    if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
    ;
    if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
    ;
    // Authorization 헤더에서 토큰 추출
    const authHeader = request.headers.get('authorization');
    const token = authHeader?.replace('Bearer ', '');
    const client = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createClient"])(supabaseUrl, supabaseServiceKey, {
        auth: {
            autoRefreshToken: false,
            persistSession: false
        },
        global: {
            headers: token ? {
                Authorization: `Bearer ${token}`
            } : {}
        }
    });
    return client;
}
// JWT 토큰 검증 함수
async function verifySupabaseJWT(token) {
    try {
        const supabaseUrl = ("TURBOPACK compile-time value", "https://fwbkesioorqklhlcgmio.supabase.co");
        if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
        ;
        // Supabase JWT 검증을 위한 JWKS URL
        const jwksUrl = new URL(`${supabaseUrl}/rest/v1/jwks`);
        const JWKS = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwks$2f$remote$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createRemoteJWKSet"])(jwksUrl);
        // JWT 검증
        const { payload } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwt$2f$verify$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["jwtVerify"])(token, JWKS, {
            issuer: 'supabase',
            audience: 'authenticated'
        });
        // 사용자 ID 반환
        return payload.sub || null;
    } catch (error) {
        console.log('JWT verification failed:', error);
        return null;
    }
}
async function getUserFromRequest(request) {
    try {
        console.log('Getting user from request, NODE_ENV:', ("TURBOPACK compile-time value", "development"));
        // 인증 토큰 확인 시도
        const authHeader = request.headers.get('authorization');
        const token = authHeader?.replace('Bearer ', '');
        if (token) {
            console.log('Token found, attempting validation...');
            try {
                // JWT 토큰 검증 (보안 강화)
                const userId = await verifySupabaseJWT(token);
                if (userId && userId !== 'undefined') {
                    console.log('Valid authenticated user from token:', userId);
                    // 사용자 존재 확인 (선택적)
                    const supabase = createServerSupabaseClient();
                    const { data: user } = await supabase.from('users').select('id').eq('id', userId).single();
                    if (user) {
                        console.log('User exists in database:', user.id);
                        return user.id;
                    } else {
                        console.log('User not found in database, creating demo user');
                    }
                }
            } catch (tokenError) {
                console.log('Token verification failed:', tokenError);
            }
        } else {
            console.log('No authorization token found');
        }
        // 토큰이 없거나 검증 실패 시 데모 사용자 생성/반환
        console.log('Falling back to demo user');
        return await getOrCreateDemoUser();
    } catch (error) {
        console.error('Error getting user from request:', error);
        // 에러 발생 시에도 데모 사용자 반환
        return await getOrCreateDemoUser();
    }
}
// 데모 사용자 생성 또는 기존 사용자 반환
async function getOrCreateDemoUser() {
    try {
        // service role key가 없으면 고정 데모 사용자 ID만 반환
        if (!process.env.SUPABASE_SERVICE_ROLE_KEY) {
            console.log('No service role key available, using hardcoded demo user ID');
            return '80d20e48-7189-4874-b792-9e514aaa0572';
        }
        const supabase = createServerSupabaseClient();
        // 기존 데모 사용자 확인
        const { data: existingUsers } = await supabase.from('users').select('id').eq('email', 'demo@talksign.app').limit(1);
        if (existingUsers && existingUsers.length > 0) {
            console.log('Using existing demo user:', existingUsers[0].id);
            return existingUsers[0].id;
        }
        // 데모 사용자 생성
        const demoUserData = {
            id: '80d20e48-7189-4874-b792-9e514aaa0572',
            email: 'demo@talksign.app',
            name: '데모 사용자',
            phone: '010-1234-5678',
            company_name: '데모 회사',
            business_name: '데모 비즈니스',
            business_registration_number: '123-45-67890',
            created_at: new Date().toISOString(),
            updated_at: new Date().toISOString()
        };
        const { data: newUser, error } = await supabase.from('users').upsert(demoUserData, {
            onConflict: 'id'
        }).select('id').single();
        if (error) {
            console.error('Failed to create demo user:', error);
            // 실패해도 고정 ID 반환
            return '80d20e48-7189-4874-b792-9e514aaa0572';
        }
        console.log('Created demo user:', newUser.id);
        return newUser.id;
    } catch (error) {
        console.error('Error in getOrCreateDemoUser:', error);
        // 모든 것이 실패해도 고정 ID 반환
        return '80d20e48-7189-4874-b792-9e514aaa0572';
    }
}
function createUserSupabaseClient(request) {
    const supabaseUrl = ("TURBOPACK compile-time value", "https://fwbkesioorqklhlcgmio.supabase.co");
    const supabaseAnonKey = ("TURBOPACK compile-time value", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ3Ymtlc2lvb3Jxa2xobGNnbWlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyNDkxNzgsImV4cCI6MjA3MDgyNTE3OH0.YWsNJBHYzbm-y-zRNfxRu777qVU_8NYEWmLa62tf-3I");
    if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
    ;
    if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
    ;
    // Authorization 헤더에서 토큰 추출
    const authHeader = request.headers.get('authorization');
    const token = authHeader?.replace('Bearer ', '');
    const client = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createClient"])(supabaseUrl, supabaseAnonKey, {
        auth: {
            autoRefreshToken: false,
            persistSession: false
        },
        global: {
            headers: token ? {
                Authorization: `Bearer ${token}`
            } : {}
        }
    });
    return client;
}
function createServerSupabaseClient() {
    const supabaseUrl = ("TURBOPACK compile-time value", "https://fwbkesioorqklhlcgmio.supabase.co");
    const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY || ("TURBOPACK compile-time value", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ3Ymtlc2lvb3Jxa2xobGNnbWlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyNDkxNzgsImV4cCI6MjA3MDgyNTE3OH0.YWsNJBHYzbm-y-zRNfxRu777qVU_8NYEWmLa62tf-3I");
    if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
    ;
    if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
    ;
    const client = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createClient"])(supabaseUrl, supabaseServiceKey, {
        auth: {
            autoRefreshToken: false,
            persistSession: false
        }
    });
    return client;
}
}),
"[project]/apps/app/src/lib/mockData.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

// Mock 데이터 관리용 모듈
// 실제 환경에서는 데이터베이스를 사용하지만, 개발 중에는 localStorage 기반 mock 데이터 사용
__turbopack_context__.s({
    "MockCustomerService": ()=>MockCustomerService
});
// localStorage key
const CUSTOMERS_STORAGE_KEY = 'talksign_customers';
// localStorage 헬퍼 함수들
const loadCustomersFromStorage = ()=>{
    if ("TURBOPACK compile-time truthy", 1) return defaultCustomers; // 서버사이드에서는 기본 데이터 반환
    //TURBOPACK unreachable
    ;
};
const saveCustomersToStorage = (customers)=>{
    if ("TURBOPACK compile-time truthy", 1) return; // 서버사이드에서는 실행하지 않음
    //TURBOPACK unreachable
    ;
};
// 기본 Mock 데이터
const defaultCustomers = [
    {
        id: '550e8400-e29b-41d4-a716-446655440001',
        company_name: '(주)스타트업에이',
        representative_name: '김사장',
        contact_person: '이담당',
        business_registration_number: '123-45-67890',
        email: 'contact@startup-a.com',
        phone: '02-1234-5678',
        address: '서울시 강남구 테헤란로 123, 스타트업타워 5층',
        created_at: '2024-01-15T09:00:00Z',
        updated_at: '2024-01-15T09:00:00Z'
    },
    {
        id: '550e8400-e29b-41d4-a716-446655440002',
        company_name: '테크솔루션즈',
        representative_name: '박대표',
        contact_person: '최매니저',
        business_registration_number: '234-56-78901',
        email: 'info@techsolutions.com',
        phone: '02-9876-5432',
        address: '서울시 서초구 강남대로 456, 테크빌딩 10층',
        created_at: '2024-02-01T10:30:00Z',
        updated_at: '2024-02-01T10:30:00Z'
    },
    {
        id: '550e8400-e29b-41d4-a716-446655440003',
        company_name: '디자인스튜디오',
        representative_name: '정실장',
        contact_person: null,
        business_registration_number: null,
        email: 'hello@designstudio.co.kr',
        phone: '010-1111-2222',
        address: '서울시 마포구 홍대입구로 789, 크리에이티브센터 3층',
        created_at: '2024-02-10T14:15:00Z',
        updated_at: '2024-02-10T14:15:00Z'
    },
    {
        id: '550e8400-e29b-41d4-a716-446655440004',
        company_name: '글로벌인더스트리',
        representative_name: '송회장',
        contact_person: '윤과장',
        business_registration_number: '345-67-89012',
        email: 'business@global-industry.com',
        phone: '02-5555-6666',
        address: '부산시 해운대구 센텀중앙로 100, 글로벌타워 20층',
        created_at: '2024-02-15T16:45:00Z',
        updated_at: '2024-02-15T16:45:00Z'
    },
    {
        id: '550e8400-e29b-41d4-a716-446655440005',
        company_name: '스마트솔루션',
        representative_name: '한이사',
        contact_person: '신차장',
        business_registration_number: '456-78-90123',
        email: 'contact@smart-sol.kr',
        phone: '031-7777-8888',
        address: '경기도 성남시 분당구 판교로 200, 스마트빌딩 7층',
        created_at: '2024-02-20T11:20:00Z',
        updated_at: '2024-02-20T11:20:00Z'
    }
];
// 고객 데이터를 메모리와 localStorage에서 가져오기
const getCustomers = ()=>{
    return loadCustomersFromStorage();
};
let mockCustomers = getCustomers();
const MockCustomerService = {
    // 모든 고객 조회
    getAll () {
        mockCustomers = getCustomers(); // localStorage에서 최신 데이터 로드
        return [
            ...mockCustomers
        ].sort((a, b)=>new Date(b.created_at).getTime() - new Date(a.created_at).getTime());
    },
    // ID로 고객 조회
    getById (id) {
        mockCustomers = getCustomers(); // localStorage에서 최신 데이터 로드
        return mockCustomers.find((customer)=>customer.id === id);
    },
    // 새 고객 추가
    create (customerData) {
        mockCustomers = getCustomers(); // localStorage에서 최신 데이터 로드
        const newCustomer = {
            ...customerData,
            id: `550e8400-e29b-41d4-a716-${Date.now()}`,
            created_at: new Date().toISOString(),
            updated_at: new Date().toISOString()
        };
        mockCustomers.unshift(newCustomer);
        saveCustomersToStorage(mockCustomers); // localStorage에 저장
        return newCustomer;
    },
    // 고객 정보 업데이트
    update (id, customerData) {
        mockCustomers = getCustomers(); // localStorage에서 최신 데이터 로드
        const customerIndex = mockCustomers.findIndex((customer)=>customer.id === id);
        if (customerIndex === -1) {
            return null;
        }
        const updatedCustomer = {
            ...mockCustomers[customerIndex],
            ...customerData,
            updated_at: new Date().toISOString()
        };
        mockCustomers[customerIndex] = updatedCustomer;
        saveCustomersToStorage(mockCustomers); // localStorage에 저장
        return updatedCustomer;
    },
    // 고객 삭제
    delete (ids) {
        mockCustomers = getCustomers(); // localStorage에서 최신 데이터 로드
        const initialLength = mockCustomers.length;
        mockCustomers = mockCustomers.filter((customer)=>!ids.includes(customer.id));
        saveCustomersToStorage(mockCustomers); // localStorage에 저장
        return initialLength - mockCustomers.length;
    }
};
}),
"[project]/apps/app/src/app/api/customers/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s({
    "DELETE": ()=>DELETE,
    "GET": ()=>GET,
    "POST": ()=>POST
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$app$2f$src$2f$lib$2f$auth$2d$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/apps/app/src/lib/auth-utils.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$app$2f$src$2f$lib$2f$mockData$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/apps/app/src/lib/mockData.ts [app-route] (ecmascript)");
;
;
;
async function GET(request) {
    try {
        console.log('API Route: GET /api/customers called');
        // 사용자 인증 확인
        const userId = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$app$2f$src$2f$lib$2f$auth$2d$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getUserFromRequest"])(request);
        if (!userId) {
            console.log('Unauthorized access attempt');
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Unauthorized'
            }, {
                status: 401
            });
        }
        console.log('Authenticated user:', userId);
        // 개발 환경에서 RLS 우회를 위해 users 테이블에 demo user 먼저 생성
        if ("TURBOPACK compile-time truthy", 1) {
            try {
                const demoUserData = {
                    id: userId,
                    email: 'demo@talksign.co.kr',
                    name: '데모 사용자',
                    created_at: new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };
                // supabaseAdmin을 사용하여 사용자 생성 (RLS 우회)
                const { supabaseAdmin } = await __turbopack_context__.r("[project]/apps/app/src/lib/supabase.ts [app-route] (ecmascript, async loader)")(__turbopack_context__.i);
                await supabaseAdmin.from('users').upsert(demoUserData, {
                    onConflict: 'id'
                });
                console.log('Demo user ensured for GET request in development');
            } catch (userError) {
                console.warn('Failed to ensure demo user:', userError);
            }
        }
        // RLS가 적용된 Supabase 클라이언트로 데이터 가져오기
        try {
            const supabase = (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$app$2f$src$2f$lib$2f$auth$2d$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createUserSupabaseClient"])(request);
            console.log('Fetching customers for user:', userId);
            const { data: customers, error } = await supabase.from('customers').select('*').order('created_at', {
                ascending: false
            });
            if (error) {
                console.error('Supabase query error:', error);
                console.log('Error details:', JSON.stringify(error, null, 2));
                // Supabase 연결 실패 시 mock 데이터 사용 (사용자별로)
                const customers = __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$app$2f$src$2f$lib$2f$mockData$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["MockCustomerService"].getAll();
                console.log('Using mock data, fetched customers:', customers.length);
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(customers);
            }
            console.log('Successfully fetched customers from Supabase:', customers ? customers.length : 0);
            // Supabase에서 데이터를 가져왔지만 비어있는 경우에도 mock 데이터 사용
            if (!customers || customers.length === 0) {
                console.log('No customers in Supabase, using mock data');
                const mockCustomers = __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$app$2f$src$2f$lib$2f$mockData$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["MockCustomerService"].getAll();
                console.log('Using mock data, fetched customers:', mockCustomers.length);
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(mockCustomers);
            }
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(customers);
        } catch (supabaseError) {
            console.error('Supabase connection exception:', supabaseError);
            // 연결 실패 시 mock 데이터 사용
            const customers = __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$app$2f$src$2f$lib$2f$mockData$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["MockCustomerService"].getAll();
            console.log('Using mock data, fetched customers:', customers.length);
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(customers);
        }
    } catch (error) {
        console.error('Unexpected error:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Internal server error'
        }, {
            status: 500
        });
    }
}
async function POST(request) {
    try {
        // 사용자 인증 확인
        const userId = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$app$2f$src$2f$lib$2f$auth$2d$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getUserFromRequest"])(request);
        if (!userId) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Unauthorized'
            }, {
                status: 401
            });
        }
        const body = await request.json();
        console.log('API Route: POST /api/customers called for user:', userId);
        console.log('Request body:', body);
        // 입력값 검증
        const requiredFields = [
            'company_name',
            'representative_name',
            'email',
            'phone'
        ];
        const missingFields = requiredFields.filter((field)=>!body[field]?.trim());
        if (missingFields.length > 0) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: `Missing required fields: ${missingFields.join(', ')}`
            }, {
                status: 400
            });
        }
        // 이메일 형식 검증
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(body.email)) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Invalid email format'
            }, {
                status: 400
            });
        }
        // 개발 환경에서 RLS 우회를 위해 users 테이블에 demo user 먼저 생성
        if ("TURBOPACK compile-time truthy", 1) {
            try {
                const demoUserData = {
                    id: userId,
                    email: 'demo@talksign.co.kr',
                    name: '데모 사용자',
                    created_at: new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };
                // supabaseAdmin을 사용하여 사용자 생성 (RLS 우회)
                const { supabaseAdmin } = await __turbopack_context__.r("[project]/apps/app/src/lib/supabase.ts [app-route] (ecmascript, async loader)")(__turbopack_context__.i);
                await supabaseAdmin.from('users').upsert(demoUserData, {
                    onConflict: 'id'
                });
                console.log('Demo user created/updated for development');
            } catch (userError) {
                console.warn('Failed to create demo user:', userError);
            }
        }
        // Supabase에 데이터 저장 (user_id 포함)
        try {
            const supabase = (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$app$2f$src$2f$lib$2f$auth$2d$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createUserSupabaseClient"])(request);
            const { data: newCustomer, error } = await supabase.from('customers').insert([
                {
                    user_id: userId,
                    company_name: body.company_name.trim(),
                    representative_name: body.representative_name.trim(),
                    contact_person: body.contact_person?.trim() || null,
                    business_registration_number: body.business_registration_number?.trim() || null,
                    email: body.email.trim(),
                    phone: body.phone.trim(),
                    address: body.address?.trim() || null
                }
            ]).select().single();
            if (error) {
                console.log('Supabase error, using mock data:', error.message);
                // Supabase 실패 시 mock 데이터 사용
                const newCustomer = __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$app$2f$src$2f$lib$2f$mockData$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["MockCustomerService"].create({
                    company_name: body.company_name.trim(),
                    representative_name: body.representative_name.trim(),
                    contact_person: body.contact_person?.trim() || null,
                    business_registration_number: body.business_registration_number?.trim() || null,
                    email: body.email.trim(),
                    phone: body.phone.trim(),
                    address: body.address?.trim() || null
                });
                console.log('Customer created with mock data:', newCustomer);
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(newCustomer, {
                    status: 201
                });
            }
            console.log('Customer created in Supabase:', newCustomer);
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(newCustomer, {
                status: 201
            });
        } catch (supabaseError) {
            console.log('Supabase connection failed, using mock data:', supabaseError);
            // Supabase 연결 실패 시 mock 데이터 사용
            const newCustomer = __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$app$2f$src$2f$lib$2f$mockData$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["MockCustomerService"].create({
                company_name: body.company_name.trim(),
                representative_name: body.representative_name.trim(),
                contact_person: body.contact_person?.trim() || null,
                business_registration_number: body.business_registration_number?.trim() || null,
                email: body.email.trim(),
                phone: body.phone.trim(),
                address: body.address?.trim() || null
            });
            console.log('Customer created with mock data:', newCustomer);
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(newCustomer, {
                status: 201
            });
        }
    } catch (error) {
        console.error('Unexpected error:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Internal server error',
            details: error instanceof Error ? error.message : 'Unknown error'
        }, {
            status: 500
        });
    }
}
async function DELETE(request) {
    try {
        // 사용자 인증 확인
        const userId = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$app$2f$src$2f$lib$2f$auth$2d$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getUserFromRequest"])(request);
        if (!userId) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Unauthorized'
            }, {
                status: 401
            });
        }
        const body = await request.json();
        const { customerIds } = body;
        console.log('API Route: DELETE /api/customers called for user:', userId);
        console.log('Customer IDs to delete:', customerIds);
        if (!customerIds || !Array.isArray(customerIds) || customerIds.length === 0) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Customer IDs array is required'
            }, {
                status: 400
            });
        }
        // RLS가 적용된 Supabase 클라이언트로 삭제 (사용자 소유 데이터만 삭제 가능)
        try {
            const supabase = (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$app$2f$src$2f$lib$2f$auth$2d$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createUserSupabaseClient"])(request);
            const { error } = await supabase.from('customers').delete().in('id', customerIds);
            if (error) {
                console.log('Supabase error, using mock data:', error.message);
                // Supabase 실패 시 mock 데이터 사용
                const deletedCount = __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$app$2f$src$2f$lib$2f$mockData$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["MockCustomerService"].delete(customerIds);
                console.log('Customers deleted from mock data:', deletedCount);
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    message: `${deletedCount} customers deleted successfully`,
                    deletedCount: deletedCount
                }, {
                    status: 200
                });
            }
            console.log('Customers deleted from Supabase:', customerIds.length);
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                message: `${customerIds.length} customers deleted successfully`,
                deletedCount: customerIds.length
            }, {
                status: 200
            });
        } catch (supabaseError) {
            console.log('Supabase connection failed, using mock data:', supabaseError);
            // Supabase 연결 실패 시 mock 데이터 사용
            const deletedCount = __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$app$2f$src$2f$lib$2f$mockData$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["MockCustomerService"].delete(customerIds);
            console.log('Customers deleted from mock data:', deletedCount);
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                message: `${deletedCount} customers deleted successfully`,
                deletedCount: deletedCount
            }, {
                status: 200
            });
        }
    } catch (error) {
        console.error('Unexpected error:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Internal server error',
            details: error instanceof Error ? error.message : 'Unknown error'
        }, {
            status: 500
        });
    }
}
}),

};

//# sourceMappingURL=%5Broot-of-the-server%5D__209982cb._.js.map
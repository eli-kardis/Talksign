module.exports = {

"[project]/apps/app/.next-internal/server/app/api/quotes/route/actions.js [app-rsc] (server actions loader, ecmascript)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
}}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/stream [external] (stream, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}}),
"[externals]/http [external] (http, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}}),
"[externals]/url [external] (url, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}}),
"[externals]/punycode [external] (punycode, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("punycode", () => require("punycode"));

module.exports = mod;
}}),
"[externals]/https [external] (https, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[project]/apps/app/src/lib/auth-utils.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s({
    "createAuthenticatedSupabaseClient": ()=>createAuthenticatedSupabaseClient,
    "createServerSupabaseClient": ()=>createServerSupabaseClient,
    "createUserSupabaseClient": ()=>createUserSupabaseClient,
    "getUserFromRequest": ()=>getUserFromRequest
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@supabase/supabase-js/dist/module/index.js [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwt$2f$verify$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/jose/dist/webapi/jwt/verify.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwks$2f$remote$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/jose/dist/webapi/jwks/remote.js [app-route] (ecmascript)");
;
;
function createAuthenticatedSupabaseClient(request) {
    const supabaseUrl = ("TURBOPACK compile-time value", "https://fwbkesioorqklhlcgmio.supabase.co");
    const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY || ("TURBOPACK compile-time value", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ3Ymtlc2lvb3Jxa2xobGNnbWlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyNDkxNzgsImV4cCI6MjA3MDgyNTE3OH0.YWsNJBHYzbm-y-zRNfxRu777qVU_8NYEWmLa62tf-3I");
    if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
    ;
    if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
    ;
    // Authorization 헤더에서 토큰 추출
    const authHeader = request.headers.get('authorization');
    const token = authHeader?.replace('Bearer ', '');
    const client = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createClient"])(supabaseUrl, supabaseServiceKey, {
        auth: {
            autoRefreshToken: false,
            persistSession: false
        },
        global: {
            headers: token ? {
                Authorization: `Bearer ${token}`
            } : {}
        }
    });
    return client;
}
// JWT 토큰 검증 함수
async function verifySupabaseJWT(token) {
    try {
        const supabaseUrl = ("TURBOPACK compile-time value", "https://fwbkesioorqklhlcgmio.supabase.co");
        if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
        ;
        // Supabase JWT 검증을 위한 JWKS URL
        const jwksUrl = new URL(`${supabaseUrl}/rest/v1/jwks`);
        const JWKS = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwks$2f$remote$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createRemoteJWKSet"])(jwksUrl);
        // JWT 검증
        const { payload } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$webapi$2f$jwt$2f$verify$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["jwtVerify"])(token, JWKS, {
            issuer: 'supabase',
            audience: 'authenticated'
        });
        // 사용자 ID 반환
        return payload.sub || null;
    } catch (error) {
        console.log('JWT verification failed:', error);
        return null;
    }
}
async function getUserFromRequest(request) {
    try {
        console.log('Getting user from request, NODE_ENV:', ("TURBOPACK compile-time value", "development"));
        // 인증 토큰 확인 시도
        const authHeader = request.headers.get('authorization');
        const token = authHeader?.replace('Bearer ', '');
        if (token) {
            console.log('Token found, attempting validation...');
            try {
                // JWT 토큰 검증 (보안 강화)
                const userId = await verifySupabaseJWT(token);
                if (userId && userId !== 'undefined') {
                    console.log('Valid authenticated user from token:', userId);
                    // 사용자 존재 확인 (선택적)
                    const supabase = createServerSupabaseClient();
                    const { data: user } = await supabase.from('users').select('id').eq('id', userId).single();
                    if (user) {
                        console.log('User exists in database:', user.id);
                        return user.id;
                    } else {
                        console.log('User not found in database, creating demo user');
                    }
                }
            } catch (tokenError) {
                console.log('Token verification failed:', tokenError);
            }
        } else {
            console.log('No authorization token found');
        }
        // 토큰이 없거나 검증 실패 시 데모 사용자 생성/반환
        console.log('Falling back to demo user');
        return await getOrCreateDemoUser();
    } catch (error) {
        console.error('Error getting user from request:', error);
        // 에러 발생 시에도 데모 사용자 반환
        return await getOrCreateDemoUser();
    }
}
// 데모 사용자 생성 또는 기존 사용자 반환
async function getOrCreateDemoUser() {
    try {
        // service role key가 없으면 고정 데모 사용자 ID만 반환
        if (!process.env.SUPABASE_SERVICE_ROLE_KEY) {
            console.log('No service role key available, using hardcoded demo user ID');
            return '80d20e48-7189-4874-b792-9e514aaa0572';
        }
        const supabase = createServerSupabaseClient();
        // 기존 데모 사용자 확인
        const { data: existingUsers } = await supabase.from('users').select('id').eq('email', 'demo@talksign.app').limit(1);
        if (existingUsers && existingUsers.length > 0) {
            console.log('Using existing demo user:', existingUsers[0].id);
            return existingUsers[0].id;
        }
        // 데모 사용자 생성
        const demoUserData = {
            id: '80d20e48-7189-4874-b792-9e514aaa0572',
            email: 'demo@talksign.app',
            name: '데모 사용자',
            phone: '010-1234-5678',
            company_name: '데모 회사',
            business_name: '데모 비즈니스',
            business_registration_number: '123-45-67890',
            created_at: new Date().toISOString(),
            updated_at: new Date().toISOString()
        };
        const { data: newUser, error } = await supabase.from('users').upsert(demoUserData, {
            onConflict: 'id'
        }).select('id').single();
        if (error) {
            console.error('Failed to create demo user:', error);
            // 실패해도 고정 ID 반환
            return '80d20e48-7189-4874-b792-9e514aaa0572';
        }
        console.log('Created demo user:', newUser.id);
        return newUser.id;
    } catch (error) {
        console.error('Error in getOrCreateDemoUser:', error);
        // 모든 것이 실패해도 고정 ID 반환
        return '80d20e48-7189-4874-b792-9e514aaa0572';
    }
}
function createUserSupabaseClient(request) {
    const supabaseUrl = ("TURBOPACK compile-time value", "https://fwbkesioorqklhlcgmio.supabase.co");
    const supabaseAnonKey = ("TURBOPACK compile-time value", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ3Ymtlc2lvb3Jxa2xobGNnbWlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyNDkxNzgsImV4cCI6MjA3MDgyNTE3OH0.YWsNJBHYzbm-y-zRNfxRu777qVU_8NYEWmLa62tf-3I");
    if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
    ;
    if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
    ;
    // Authorization 헤더에서 토큰 추출
    const authHeader = request.headers.get('authorization');
    const token = authHeader?.replace('Bearer ', '');
    const client = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createClient"])(supabaseUrl, supabaseAnonKey, {
        auth: {
            autoRefreshToken: false,
            persistSession: false
        },
        global: {
            headers: token ? {
                Authorization: `Bearer ${token}`
            } : {}
        }
    });
    return client;
}
function createServerSupabaseClient() {
    const supabaseUrl = ("TURBOPACK compile-time value", "https://fwbkesioorqklhlcgmio.supabase.co");
    const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY || ("TURBOPACK compile-time value", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ3Ymtlc2lvb3Jxa2xobGNnbWlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyNDkxNzgsImV4cCI6MjA3MDgyNTE3OH0.YWsNJBHYzbm-y-zRNfxRu777qVU_8NYEWmLa62tf-3I");
    if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
    ;
    if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
    ;
    const client = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createClient"])(supabaseUrl, supabaseServiceKey, {
        auth: {
            autoRefreshToken: false,
            persistSession: false
        }
    });
    return client;
}
}),
"[project]/apps/app/src/lib/supabase.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s({
    "API_BASE_URL": ()=>API_BASE_URL,
    "apiRequest": ()=>apiRequest,
    "supabase": ()=>supabase,
    "supabaseAdmin": ()=>supabaseAdmin
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@supabase/supabase-js/dist/module/index.js [app-route] (ecmascript) <locals>");
;
// 환경 변수에서 Supabase 설정 가져오기
const supabaseUrl = ("TURBOPACK compile-time value", "https://fwbkesioorqklhlcgmio.supabase.co");
const supabaseAnonKey = ("TURBOPACK compile-time value", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ3Ymtlc2lvb3Jxa2xobGNnbWlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyNDkxNzgsImV4cCI6MjA3MDgyNTE3OH0.YWsNJBHYzbm-y-zRNfxRu777qVU_8NYEWmLa62tf-3I");
const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;
// 필수 환경 변수 검증
if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
;
if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
;
if (!supabaseServiceKey) {
    console.warn('Missing SUPABASE_SERVICE_ROLE_KEY - using anon key for service operations');
}
const supabase = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createClient"])(supabaseUrl, supabaseAnonKey);
const supabaseAdmin = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createClient"])(supabaseUrl, supabaseServiceKey || supabaseAnonKey, {
    auth: {
        autoRefreshToken: false,
        persistSession: false
    }
});
const API_BASE_URL = `${supabaseUrl}/functions/v1/make-server-e83d4894`;
async function apiRequest(endpoint, options = {}) {
    const url = `${API_BASE_URL}${endpoint}`;
    const defaultHeaders = {
        'Content-Type': 'application/json'
    };
    // 현재 세션에서 액세스 토큰 가져오기
    const { data: { session } } = await supabase.auth.getSession();
    if (session?.access_token) {
        defaultHeaders['Authorization'] = `Bearer ${session.access_token}`;
    }
    const response = await fetch(url, {
        ...options,
        headers: {
            ...defaultHeaders,
            ...options.headers
        }
    });
    if (!response.ok) {
        const errorData = await response.json().catch(()=>({}));
        throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
    }
    return response.json();
}
}),
"[project]/apps/app/src/app/api/quotes/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s({
    "GET": ()=>GET,
    "POST": ()=>POST
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$app$2f$src$2f$lib$2f$auth$2d$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/apps/app/src/lib/auth-utils.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$app$2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/apps/app/src/lib/supabase.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@supabase/supabase-js/dist/module/index.js [app-route] (ecmascript) <locals>");
;
;
;
;
async function GET(request) {
    try {
        console.log('API Route: GET /api/quotes called');
        // 사용자 인증 확인
        const userId = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$app$2f$src$2f$lib$2f$auth$2d$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getUserFromRequest"])(request);
        if (!userId) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Unauthorized'
            }, {
                status: 401
            });
        }
        console.log('Fetching quotes for user:', userId);
        // 사용자별 클라이언트로 견적서 조회 (RLS 적용)
        const supabase = (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$app$2f$src$2f$lib$2f$auth$2d$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createUserSupabaseClient"])(request);
        const { data: quotes, error } = await supabase.from('quotes').select('*').eq('user_id', userId).order('created_at', {
            ascending: false
        });
        if (error) {
            console.error('Error fetching quotes:', error);
            // Supabase 에러 시 빈 배열 반환 (RLS 정책으로 인한 접근 제한일 수 있음)
            console.log('Returning empty array due to database error');
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json([]);
        }
        console.log('Raw quotes from database:', JSON.stringify(quotes, null, 2));
        console.log('Number of quotes found:', quotes?.length || 0);
        // 견적서가 없으면 빈 배열 반환 (정상적인 상황)
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(quotes || []);
    } catch (error) {
        console.error('Error in GET /api/quotes:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Internal server error'
        }, {
            status: 500
        });
    }
}
async function POST(request) {
    try {
        console.log('API Route: POST /api/quotes called');
        // 사용자 인증 확인 - 개발 환경에서는 현재 사용자 사용
        const userId = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$app$2f$src$2f$lib$2f$auth$2d$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getUserFromRequest"])(request);
        if (!userId) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Unauthorized'
            }, {
                status: 401
            });
        }
        console.log('Creating quote for user:', userId);
        // 사용자별 클라이언트로 견적서 생성 (RLS 적용)
        const supabase = (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$app$2f$src$2f$lib$2f$auth$2d$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createUserSupabaseClient"])(request);
        console.log('Supabase client created');
        const body = await request.json();
        console.log('Request body:', JSON.stringify(body, null, 2));
        // 필수 필드 검증
        if (!body.client_name || !body.client_email || !body.title) {
            console.log('Missing required fields');
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Missing required fields: client_name, client_email, title'
            }, {
                status: 400
            });
        }
        // 견적서 항목 총합 계산
        const items = body.items || [];
        const subtotal = items.reduce((sum, item)=>sum + (item.amount || 0), 0);
        console.log('Calculated subtotal:', subtotal);
        // 세금 계산 (기본 10%) - tax_amount와 total_amount는 데이터베이스에서 자동 계산됨
        const taxRate = body.tax_rate || 10.0;
        console.log('Tax rate:', taxRate, 'Subtotal:', subtotal);
        // 공급자 정보로 사용자 프로필 업데이트 (필요시)
        if (body.supplier_info) {
            const { error: updateError } = await supabase.from('users').update({
                name: body.supplier_info.name,
                phone: body.supplier_info.phone,
                business_registration_number: body.supplier_info.business_registration_number,
                company_name: body.supplier_info.company_name,
                business_name: body.supplier_info.business_name,
                updated_at: new Date().toISOString()
            }).eq('id', userId);
            if (updateError) {
                console.warn('Failed to update user profile:', updateError);
            // 사용자 프로필 업데이트 실패는 치명적이지 않으므로 계속 진행
            }
        }
        // 견적서 생성
        const expiresAt = body.valid_until ? new Date(body.valid_until).toISOString() : body.expires_at ? new Date(body.expires_at).toISOString() : null;
        const quoteData = {
            user_id: userId,
            client_name: body.client_name,
            client_email: body.client_email,
            client_phone: body.client_phone || null,
            client_company: body.client_company || null,
            title: body.title,
            description: body.description || null,
            items: items,
            subtotal: subtotal,
            tax_rate: taxRate,
            status: body.status || 'draft',
            expires_at: expiresAt,
            client_business_number: body.client_business_number || null,
            client_address: body.client_address || null
        };
        console.log('Quote data to insert:', JSON.stringify(quoteData, null, 2));
        // RLS 정책을 우회하기 위해 supabaseAdmin 사용 시도
        let quote, error;
        try {
            if (("TURBOPACK compile-time value", "development") === 'development' && process.env.SUPABASE_SERVICE_ROLE_KEY) {
                ({ data: quote, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$app$2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabaseAdmin"].from('quotes').insert(quoteData).select().single());
            } else {
                // 개발 환경에서 service role key가 없을 때는 anon client로 시도
                // 실제 production에서는 이 방법을 사용하면 안됨
                console.log('Warning: Using anon key for quote creation due to missing service role key');
                const anonSupabase = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createClient"])(("TURBOPACK compile-time value", "https://fwbkesioorqklhlcgmio.supabase.co"), ("TURBOPACK compile-time value", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ3Ymtlc2lvb3Jxa2xobGNnbWlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyNDkxNzgsImV4cCI6MjA3MDgyNTE3OH0.YWsNJBHYzbm-y-zRNfxRu777qVU_8NYEWmLa62tf-3I"));
                ({ data: quote, error } = await anonSupabase.from('quotes').insert(quoteData).select().single());
            }
        } catch (insertError) {
            console.error('Insert operation failed:', insertError);
            error = insertError;
        }
        if (error) {
            console.error('Failed to create quote:', error);
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Failed to create quote',
                details: error.message,
                code: error.code
            }, {
                status: 500
            });
        }
        console.log('Quote created successfully:', quote);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(quote, {
            status: 201
        });
    } catch (error) {
        console.error('Unexpected error in POST /api/quotes:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Internal server error',
            details: error instanceof Error ? error.message : 'Unknown error'
        }, {
            status: 500
        });
    }
}
}),

};

//# sourceMappingURL=%5Broot-of-the-server%5D__7c04748c._.js.map